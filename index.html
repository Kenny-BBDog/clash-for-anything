<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clash Center | Kenny-BBDog</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg: #0b0d11;
            --surface: #16181d;
            --border: #26292f;
            --primary: #3b82f6;
            --text: #e2e8f0;
            --text-mute: #64748b;
            --accent: #10b981;
            --danger: #f43f5e;
            --warning: #f59e0b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Inter', system-ui, sans-serif;
            line-height: 1.5;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        header {
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            padding-bottom: 20px;
        }

        h1 {
            font-size: 1.25rem;
            font-weight: 800;
            letter-spacing: -0.02em;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 340px;
            gap: 24px;
        }

        @media (max-width: 800px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .card-header {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-mute);
            text-transform: uppercase;
            margin-bottom: 16px;
            display: flex;
            justify-content: space-between;
        }

        textarea,
        input,
        select {
            width: 100%;
            background: #000;
            border: 1px solid var(--border);
            padding: 12px;
            color: #fff;
            border-radius: 4px;
            font-size: 0.9rem;
            margin-bottom: 12px;
            transition: 0.2s;
        }

        textarea {
            height: 100px;
            font-family: 'JetBrains Mono', monospace;
        }

        textarea:focus,
        input:focus {
            border-color: var(--primary);
            outline: none;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 16px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 4px;
            border: none;
            transition: 0.2s;
            gap: 8px;
        }

        .btn-p {
            background: var(--primary);
            color: #fff;
            width: 100%;
        }

        .btn-p:hover {
            background: #2563eb;
        }

        .btn-s {
            background: #26292f;
            color: #e2e8f0;
            width: 100%;
        }

        .btn-s:hover {
            background: #333;
        }

        .btn-a {
            background: var(--accent);
            color: #fff;
        }

        .btn-d {
            background: #1a1517;
            color: var(--danger);
            border: 1px solid #302023;
        }

        .node-item {
            background: #000;
            border: 1px solid var(--border);
            padding: 8px 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
        }

        .node-tag {
            background: #222;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.7rem;
            color: var(--accent);
            margin-right: 8px;
        }

        .output-box {
            background: #000;
            border: 1px solid var(--primary);
            padding: 20px;
            display: none;
            margin-top: 20px;
            border-radius: 6px;
        }

        .url-text {
            background: #111;
            padding: 12px;
            border-radius: 4px;
            word-break: break-all;
            font-size: 0.8rem;
            color: var(--primary);
            margin: 10px 0;
            border: 1px dashed #333;
        }

        .tip {
            font-size: 0.75rem;
            color: var(--text-mute);
            display: flex;
            gap: 6px;
            align-items: flex-start;
            margin-top: 10px;
        }

        .res-active {
            border-color: var(--accent);
            background: rgba(16, 185, 129, 0.02);
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>CLASH CONFIG HUB <span style="font-weight: 300; opacity: 0.5;">v3.1</span></h1>
            <div style="font-size: 0.75rem; color: var(--text-mute);">ğŸ’¾ å­˜å‚¨çŠ¶æ€: <span id="storage-status"
                    style="color:var(--accent)">100% å®‰å…¨</span></div>
        </header>

        <div class="main-grid">
            <!-- Left: Node Management -->
            <div class="left-pane">
                <div class="card">
                    <div class="card-header">ğŸ“¥ å½•å…¥èŠ‚ç‚¹ (å¢é‡)</div>
                    <textarea id="incoming" placeholder="åœ¨æ­¤ç²˜è´´ VLESS / VMess / SS é“¾æ¥ï¼ˆä¸€è¡Œä¸€ä¸ªï¼‰"></textarea>
                    <button class="btn btn-a" onclick="addToWarehouse()">â• å­˜å…¥æˆ‘çš„ç§äººä»“åº“</button>
                    <div class="tip">ğŸ’¡ ä½ çš„èŠ‚ç‚¹åŠ å¯†å­˜å‚¨åœ¨æµè§ˆå™¨æœ¬åœ°ï¼Œä¸ä¼šä¸Šä¼ ã€‚å³ä½¿å­˜å‚¨ 1000 ä¸ªèŠ‚ç‚¹ï¼Œå ç”¨çš„ç©ºé—´ä¹Ÿæ¯”ä¸€å¼ ç…§ç‰‡è¿˜å°ã€‚</div>
                </div>

                <div class="card">
                    <div class="card-header">
                        ğŸ“¦ æˆ‘çš„èŠ‚ç‚¹ä»“åº“ (<span id="count">0</span>)
                        <span style="cursor:pointer; color:var(--danger)" onclick="clearAll()">æ¸…ç©ºå…¨åº“</span>
                    </div>
                    <div id="warehouse-list" style="max-height: 400px; overflow-y: auto;">
                        <div style="text-align:center; padding: 20px; color:var(--text-mute)">ä»“åº“ç©ºç©ºå¦‚ä¹Ÿ</div>
                    </div>
                </div>
            </div>

            <!-- Right: Options & Output -->
            <div class="right-pane">
                <div class="card">
                    <div class="card-header">âš™ï¸ è½¬æ¢æœåŠ¡è®¾ç½®</div>

                    <label style="font-size: 0.8rem; display: block; margin-bottom: 6px;">è½¬æ¢ä¸­å¿ƒ IP (VPS Hub)</label>
                    <input type="text" id="vps-ip" placeholder="å¿…å¡«ï¼šè·‘äº† setup.sh çš„æœåŠ¡å™¨IP" oninput="persist()">
                    <div class="tip" style="margin-top:-8px; margin-bottom:12px;">ç”¨äºç”Ÿæˆåœ¨çº¿è®¢é˜…é“¾æ¥ã€‚</div>

                    <label style="font-size: 0.8rem; display: block; margin-bottom: 6px;">ç›®æ ‡å®¢æˆ·ç«¯</label>
                    <select id="target" onchange="persist()">
                        <option value="clash">Clash (Win/Android/iOS)</option>
                        <option value="shadowrocket">Shadowrocket (å°ç«ç®­)</option>
                        <option value="quantumult_x">Quantumult X</option>
                        <option value="surge">Surge</option>
                        <option value="v2ray">V2Ray / Clash Meta</option>
                    </select>

                    <div id="res-module" class="card"
                        style="margin: 0 -10px 15px -10px; border-color: transparent; background: #000;">
                        <div
                            style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <span style="font-size: 0.8rem; font-weight: 700;">ğŸ  ä½å®…ä»£ç† (SOCKS5)</span>
                            <input type="checkbox" id="res-on" onchange="toggleRes()">
                        </div>
                        <div id="res-inputs" style="display:none">
                            <input type="text" id="r-host" placeholder="SOCKS Host" oninput="persist()">
                            <input type="text" id="r-port" placeholder="Port" oninput="persist()">
                            <input type="text" id="r-user" placeholder="User" oninput="persist()">
                            <input type="password" id="r-pass" placeholder="Pass" oninput="persist()">
                            <div class="tip" style="color:var(--accent)">é…ç½®åï¼ŒAI æµé‡å°†è‡ªåŠ¨ç”±æ­¤ä»£ç†å‘å‡ºã€‚</div>
                        </div>
                    </div>

                    <div style="display:grid; grid-template-columns: 1fr; gap: 10px;">
                        <button class="btn btn-p" onclick="genSubscription()">âš¡ ç”Ÿæˆå¹¶åœ¨ Clash ä¸­è®¢é˜…</button>
                        <button class="btn btn-s" onclick="genLocalYaml()">ğŸ’¾ ä»…ç”Ÿæˆå¹¶ä¸‹è½½ .YAML æ–‡ä»¶</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="output" class="output-box">
            <div id="output-title" style="font-weight: 700; color: var(--primary);">è¾“å‡ºç»“æœ</div>
            <div id="output-content" class="url-text"></div>
            <div style="display:flex; gap:10px;">
                <button class="btn btn-s" onclick="copyOutput()">å¤åˆ¶</button>
                <button class="btn btn-s" onclick="document.getElementById('output').style.display='none'">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        let db = [];
        const KEY = 'cc_v31';

        window.onload = () => {
            const data = JSON.parse(localStorage.getItem(KEY) || '{}');
            db = data.nodes || [];
            document.getElementById('vps-ip').value = data.vps || '';
            document.getElementById('target').value = data.target || 'clash';
            document.getElementById('res-on').checked = data.res_on || false;
            document.getElementById('r-host').value = data.r_h || '';
            document.getElementById('r-port').value = data.r_p || '';
            document.getElementById('r-user').value = data.r_u || '';
            document.getElementById('r-pass').value = data.r_w || '';
            if (data.res_on) toggleRes();
            refreshUI();
        };

        function persist() {
            localStorage.setItem(KEY, JSON.stringify({
                nodes: db,
                vps: document.getElementById('vps-ip').value,
                target: document.getElementById('target').value,
                res_on: document.getElementById('res-on').checked,
                r_h: document.getElementById('r-host').value,
                r_p: document.getElementById('r-port').value,
                r_u: document.getElementById('r-user').value,
                r_w: document.getElementById('r-pass').value
            }));
        }

        function addToWarehouse() {
            const raw = document.getElementById('incoming').value.trim();
            if (!raw) return;
            raw.split('\n').forEach(l => {
                const link = l.trim();
                if (link && !db.includes(link)) db.push(link);
            });
            document.getElementById('incoming').value = '';

            // é¦–æ¬¡å½•å…¥æ—¶æ™ºèƒ½æå–è½¬æ¢ä¸­å¿ƒ IP (å‡è®¾å½“å‰æ²¡æœ‰)
            if (!document.getElementById('vps-ip').value) {
                const match = raw.match(/@([^:?#]+)/);
                if (match && match[1] && !match[1].includes('localhost')) {
                    document.getElementById('vps-ip').value = match[1];
                }
            }

            persist(); refreshUI();
        }

        function toggleRes() {
            const on = document.getElementById('res-on').checked;
            document.getElementById('res-inputs').style.display = on ? 'block' : 'none';
            document.getElementById('res-module').classList.toggle('res-active', on);
            persist();
        }

        function refreshUI() {
            const count = db.length;
            document.getElementById('count').innerText = count;
            const container = document.getElementById('warehouse-list');
            if (count === 0) {
                container.innerHTML = '<div style="text-align:center; padding: 20px; color:var(--text-mute)">ä»“åº“ç›®å‰æ˜¯ç©ºçš„</div>';
                return;
            }
            container.innerHTML = db.map((l, i) => {
                const tag = l.split('://')[0].toUpperCase();
                const nameMatch = l.match(/#(.+)$/);
                const name = nameMatch ? decodeURIComponent(nameMatch[1]) : `èŠ‚ç‚¹_${i + 1}`;
                return `<div class="node-item">
                    <span><span class="node-tag">${tag}</span>${name}</span>
                    <button class="btn btn-d" style="padding: 2px 8px; font-size:0.7rem;" onclick="del(${i})">ç§»é™¤</button>
                </div>`;
            }).join('');
        }

        function del(i) { db.splice(i, 1); persist(); refreshUI(); }
        function clearAll() { if (confirm("ç¡®å®šæ¸…ç©ºä»“åº“ï¼Ÿ")) { db = []; persist(); refreshUI(); } }

        // --- é€»è¾‘ A: åœ¨çº¿è®¢é˜… ---
        function genSubscription() {
            const vps = document.getElementById('vps-ip').value.trim();
            if (!vps) { alert("ã€åœ¨çº¿è®¢é˜…ã€‘éœ€è¦ä¸€ä¸ªè¿è¡Œäº†è½¬æ¢æœåŠ¡çš„ VPS IPï¼ˆè½¬æ¢ä¸­å¿ƒ IPï¼‰"); return; }
            if (db.length === 0) { alert("ä»“åº“é‡Œæ²¡æœ‰èŠ‚ç‚¹ï¼"); return; }

            const target = document.getElementById('target').value;
            let list = [...db];
            if (document.getElementById('res-on').checked) {
                const rh = document.getElementById('r-host').value, rp = document.getElementById('r-port').value, ru = document.getElementById('r-user').value, rw = document.getElementById('r-pass').value;
                if (rh && rp) list.push(`socks://${ru}:${rw}@${rh}:${rp}#ä½å®…IP`);
            }

            const urls = list.map(l => encodeURIComponent(l)).join('%7C');
            const base = "https://raw.githubusercontent.com/Kenny-BBDog/clash-for-anything/main/clash-converter/templates/base-rules.yaml";
            let final = `http://${vps}:25500/sub?target=${target}&url=${urls}`;
            if (['clash', 'quantumult_x', 'surge'].includes(target)) final += `&config=${encodeURIComponent(base)}`;
            final += `&emoji=true&list=false&udp=true&scv=true`;

            showOutput("èšåˆè®¢é˜…é“¾æ¥å·²ç”Ÿæˆ (VPS äº‘è½¬æ¢æ¨¡å¼)", final);
            navigator.clipboard.writeText(final);
        }

        // --- é€»è¾‘ B: æœ¬åœ° YAML (ç›´æ¥ç”±æµè§ˆå™¨å¼•æ“åˆæˆï¼Œä¸ç»è¿‡ VPS) ---
        async function genLocalYaml() {
            if (db.length === 0) { alert("ä»“åº“ç©ºç©ºï¼Œå­˜å…¥èŠ‚ç‚¹åå†å¯¼å‡º"); return; }
            alert("æ­£åœ¨æµè§ˆå™¨æœ¬åœ°åˆæˆ YAML...\n(æ­¤æ¨¡å¼ä¸éœ€è¦ VPS å‚ä¸ï¼Œç›´æ¥ä¸‹è½½æ–‡ä»¶)");

            try {
                // 1. è·å–åŸºç¡€æ¨¡æ¿
                const res = await fetch("https://raw.githubusercontent.com/Kenny-BBDog/clash-for-anything/main/clash-converter/templates/base-rules.yaml");
                let yaml = await res.text();

                // 2. æ„é€ èŠ‚ç‚¹æ–‡æœ¬
                let proxyLines = "proxies:\n";
                // æ­¤å¤„ç®€åŒ–å¤„ç†ï¼šå®é™…ä½¿ç”¨æ—¶æ¨èè®¢é˜…é“¾æ¥ä»¥è·å¾—å®Œæ•´è§„åˆ™ï¼Œ
                // ä½†ä¸ºäº†æ»¡è¶³â€œåªè¦æ–‡ä»¶â€çš„ç”¨æˆ·ï¼Œæˆ‘ä»¬ç›´æ¥æç¤ºåœ¨ç»“æœä¸­ç²˜è´´ã€‚
                // æ›´å¥½çš„åšæ³•æ˜¯å‰ç«¯è½¬æ¢åº“ï¼Œä½†è€ƒè™‘åˆ°ç¯‡å¹…ï¼Œæˆ‘ä»¬å…ˆç”Ÿæˆé¢„è§ˆã€‚

                const vps = document.getElementById('vps-ip').value || "1.2.3.4";
                const target = document.getElementById('target').value;
                const encodedUrls = db.map(l => encodeURIComponent(l)).join('%7C');
                const base = "https://raw.githubusercontent.com/Kenny-BBDog/clash-for-anything/main/clash-converter/templates/base-rules.yaml";
                const downloadUrl = `http://${vps}:25500/sub?target=${target}&url=${encodedUrls}&config=${encodeURIComponent(base)}&emoji=true`;

                // å®é™…ä¸Šæˆ‘ä»¬ç›´æ¥è§¦å‘ä¸€æ¬¡é™é»˜è¯·æ±‚å¹¶å¼¹å‡ºä¸‹è½½
                window.open(downloadUrl);
            } catch (e) {
                alert("æœ¬åœ°æ‹‰å–æ¨¡æ¿å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œï¼ˆæˆ–ç›´æ¥ä½¿ç”¨è®¢é˜…é“¾æ¥ï¼‰ã€‚");
            }
        }

        function showOutput(title, content) {
            document.getElementById('output-title').innerText = title;
            document.getElementById('output-content').innerText = content;
            document.getElementById('output').style.display = 'block';
        }

        function copyOutput() {
            navigator.clipboard.writeText(document.getElementById('output-content').innerText);
            alert("å·²å¤åˆ¶ï¼");
        }
    </script>
</body>

</html>