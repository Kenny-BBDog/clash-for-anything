<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clash Ultimate Center | Kenny-BBDog</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Fira+Code:wght@400;500&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #00f2ff;
            --primary-glow: rgba(0, 242, 255, 0.4);
            --secondary: #7000ff;
            --bg: #030305;
            --surface: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
            --text: #ffffff;
            --text-mute: #888;
            --success: #00ff9d;
            --warning: #ffcc00;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            outline: none;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Outfit', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            background-image:
                radial-gradient(circle at top right, rgba(112, 0, 255, 0.15), transparent 40%),
                radial-gradient(circle at bottom left, rgba(0, 242, 255, 0.1), transparent 40%);
        }

        /* æå…‰åŠ¨æ•ˆèƒŒæ™¯ */
        .aurora {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            filter: blur(100px);
            opacity: 0.3;
            pointer-events: none;
        }

        .aurora-blob {
            position: absolute;
            width: 50vw;
            height: 50vw;
            border-radius: 50%;
            animation: move 20s infinite alternate;
        }

        @keyframes move {
            from {
                transform: translate(-10%, -10%);
            }

            to {
                transform: translate(20%, 20%);
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 60px 20px;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 80px;
        }

        h1 {
            font-size: 4.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #fff 30%, var(--primary) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -2px;
            margin-bottom: 10px;
        }

        .tagline {
            color: var(--text-mute);
            font-size: 1.2rem;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
        }

        @media (max-width: 1000px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Cards */
        .card {
            background: var(--surface);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 32px;
            padding: 40px;
            position: relative;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        .card::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            bottom: -1px;
            border-radius: 32px;
            background: linear-gradient(135deg, var(--border), transparent);
            pointer-events: none;
            z-index: -1;
        }

        h2 {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.5rem;
            margin-bottom: 30px;
            color: var(--primary);
        }

        /* Inputs */
        .input-group {
            margin-bottom: 30px;
        }

        label {
            display: block;
            font-size: 0.8rem;
            color: var(--text-mute);
            margin-bottom: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        textarea,
        input,
        select {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 18px;
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: inherit;
        }

        textarea:focus,
        input:focus,
        select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 30px var(--primary-glow);
            background: rgba(0, 0, 0, 0.5);
        }

        textarea {
            height: 200px;
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
        }

        /* Buttons */
        .btn {
            padding: 18px 32px;
            border-radius: 16px;
            border: none;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }

        .btn-magic {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: #fff;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0, 242, 255, 0.2);
        }

        .btn-magic:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 50px rgba(0, 242, 255, 0.4);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: #fff;
        }

        .btn-outline:hover {
            border-color: #fff;
            background: rgba(255, 255, 255, 0.05);
        }

        /* Toggles */
        .toggle-zone {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .toggle-item {
            background: rgba(255, 255, 255, 0.02);
            padding: 15px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            border: 1px solid var(--border);
            transition: 0.3s;
        }

        .toggle-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .toggle-item.active {
            border-color: var(--primary);
            background: rgba(0, 242, 255, 0.05);
        }

        /* Residential Module */
        .res-module {
            border: 1px solid var(--warning);
            padding: 25px;
            border-radius: 20px;
            background: rgba(255, 204, 0, 0.03);
            margin-top: 20px;
        }

        .res-title {
            color: var(--warning);
            font-weight: 800;
            font-size: 1.1rem;
        }

        /* Result Area */
        .result-zone {
            display: none;
            margin-top: 50px;
            animation: slideIn 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
        }

        .code-wrap {
            background: #000;
            border-radius: 24px;
            padding: 30px;
            border: 1px solid var(--primary);
            position: relative;
        }

        pre {
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
            color: #ccc;
            overflow: auto;
            max-height: 600px;
            line-height: 1.6;
        }

        .actions {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        /* Chips */
        .chip {
            background: rgba(255, 255, 255, 0.05);
            padding: 4px 12px;
            border-radius: 100px;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--primary);
            border: 1px solid var(--primary-glow);
        }

        /* Footer */
        footer {
            margin-top: 100px;
            text-align: center;
            padding-bottom: 50px;
            font-size: 0.9rem;
            color: var(--text-mute);
        }

        footer a {
            color: var(--text);
            text-decoration: none;
            border-bottom: 1px solid var(--primary);
        }

        /* çŠ¶æ€æŒ‡ç¤º */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            color: var(--success);
            margin-top: 15px;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            box-shadow: 0 0 10px var(--success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 0.4;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.4;
            }
        }
    </style>
</head>

<body>
    <div class="aurora">
        <div class="aurora-blob" style="background: var(--primary); top: -10%; left: -10%;"></div>
        <div class="aurora-blob" style="background: var(--secondary); bottom: -10%; right: -10%;"></div>
    </div>

    <div class="container">
        <header>
            <h1>CLASH ULTIMATE</h1>
            <p class="tagline">The Final Proxy Automation Control Center</p>
        </header>

        <div class="main-grid">
            <!-- Left: Node and Config -->
            <div class="card">
                <h2>âš¡ æ ¸å¿ƒæ•°æ®å¤„ç†</h2>

                <div class="input-group">
                    <label>è¾“å…¥ VLESS / VMess / Shadowsocks é“¾æ¥</label>
                    <textarea id="links"
                        placeholder="vless://...&#10;vmess://...&#10;æ”¯æŒæ‰¹é‡ç²˜è´´ï¼Œç›´æ¥æŠŠä½ çš„æ‰€æœ‰èŠ‚ç‚¹ä¸¢è¿›æ¥..."></textarea>
                </div>

                <div class="toggle-zone">
                    <div class="toggle-item active" onclick="toggleOption(this, 'win')">
                        <span>Windows (Mihomo)</span>
                        <input type="checkbox" checked hidden id="opt-win">
                    </div>
                    <div class="toggle-item active" onclick="toggleOption(this, 'android')">
                        <span>Android (Meta)</span>
                        <input type="checkbox" checked hidden id="opt-android">
                    </div>
                    <div class="toggle-item active" onclick="toggleOption(this, 'rule-provider')">
                        <span>äº‘ç«¯è§„åˆ™åº“ (è‡ªåŠ¨æ›´æ–°)</span>
                        <input type="checkbox" checked hidden id="opt-provider">
                    </div>
                </div>

                <button class="btn btn-magic" onclick="processMagic()">ä¸€é”®é­”æ³•ç”Ÿæˆé…ç½®æ–‡ä»¶</button>

                <div class="status-badge" id="status" style="display:none;">
                    <div class="dot"></div> <span id="status-text">ç³»ç»Ÿå°±ç»ªï¼Œç­‰å¾…è¾“å…¥...</span>
                </div>
            </div>

            <!-- Right: Hot-swap Residential -->
            <div class="card">
                <div style="display:flex; justify-content: space-between;">
                    <h2 style="color: var(--warning); margin:0;">ğŸ  ä½å®… IP æ¨¡å—</h2>
                    <span class="chip">çƒ­æ’æ‹”éš”ç¦»</span>
                </div>

                <p style="font-size: 0.85rem; color: var(--text-mute); margin: 20px 0;">é…ç½®ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°ï¼Œå³ä¾¿ä»“åº“å…¬å¼€ä¹Ÿç»ä¸æ³„æ¼ã€‚å¼€å¯å AI
                    æµé‡è‡ªåŠ¨èµ°ä½å®…é€šé“ã€‚</p>

                <div class="toggle-item" id="res-toggle" onclick="toggleRes(this)">
                    <span>å¯ç”¨æœ¬åœ°ä½å®…ä»£ç†</span>
                </div>

                <div id="res-fields" style="display: none; margin-top: 20px;">
                    <div class="input-group">
                        <label>Socks5 ä¸»æœº</label>
                        <input type="text" id="res-host" placeholder="ä¾‹å¦‚: 161.77.227.227" oninput="saveLocalRes()">
                    </div>
                    <div class="input-group">
                        <label>ç«¯å£</label>
                        <input type="text" id="res-port" placeholder="12324" oninput="saveLocalRes()">
                    </div>
                    <div class="input-group">
                        <label>è´¦å·</label>
                        <input type="text" id="res-user" placeholder="Username" oninput="saveLocalRes()">
                    </div>
                    <div class="input-group">
                        <label>å¯†ç </label>
                        <input type="password" id="res-pass" placeholder="Password" oninput="saveLocalRes()">
                    </div>
                    <div class="input-group">
                        <label>è½åœ°è½¬å‘èŠ‚ç‚¹ (çƒ­æ’æ‹”å¿…é€‰)</label>
                        <select id="res-dialer" onchange="saveLocalRes()">
                            <option value="">-- ç­‰å¾…è§£æèŠ‚ç‚¹ --</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Result -->
        <div class="result-zone" id="result">
            <div class="code-wrap">
                <div style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <h2 style="margin:0;">æˆå“é…ç½®æ–‡ä»¶</h2>
                    <span id="platform-tag" class="chip">Windows</span>
                </div>
                <div class="actions">
                    <button class="btn btn-outline" style="padding: 10px 20px; font-size: 0.8rem;"
                        onclick="copyAll()">å¤åˆ¶å…¨æ–‡</button>
                    <button class="btn btn-magic" style="padding: 10px 20px; font-size: 0.8rem;"
                        onclick="downloadFile()">ä¸‹è½½ .yaml</button>
                </div>
                <pre id="output"></pre>
            </div>
        </div>

        <footer>
            <p>Built for Kenny-BBDog | Optimized for WeChat & AI Privacy 2026</p>
            <p style="margin-top: 15px;">çº¯æœ¬åœ°è¿ç®—ï¼Œç»ä¸ä¸Šä¼ ã€‚æºç æ‰˜ç®¡äº <a
                    href="https://github.com/Kenny-BBDog/clash-for-anything">GitHub</a></p>
        </footer>
    </div>

    <script>
        let nodes = [];
        let finalYaml = "";

        // åˆå§‹åŒ–
        window.onload = () => {
            const savedRes = localStorage.getItem('ultra_res');
            if (savedRes) {
                const data = JSON.parse(savedRes);
                document.getElementById('res-host').value = data.host || '';
                document.getElementById('res-port').value = data.port || '';
                document.getElementById('res-user').value = data.user || '';
                document.getElementById('res-pass').value = data.pass || '';
                if (data.enabled) toggleRes(document.getElementById('res-toggle'));
            }
        };

        function toggleOption(el, type) {
            el.classList.toggle('active');
            const cb = document.getElementById(`opt-${type}`);
            cb.checked = !cb.checked;
        }

        function toggleRes(el) {
            el.classList.toggle('active');
            const show = el.classList.contains('active');
            document.getElementById('res-fields').style.display = show ? 'block' : 'none';
            saveLocalRes();
        }

        function saveLocalRes() {
            const data = {
                enabled: document.getElementById('res-toggle').classList.contains('active'),
                host: document.getElementById('res-host').value,
                port: document.getElementById('res-port').value,
                user: document.getElementById('res-user').value,
                pass: document.getElementById('res-pass').value,
                dialer: document.getElementById('res-dialer').value
            };
            localStorage.setItem('ultra_res', JSON.stringify(data));
        }

        function parseBatch() {
            const raw = document.getElementById('links').value;
            const lines = raw.split('\n');
            nodes = [];
            lines.forEach(l => {
                const link = l.trim();
                if (!link) return;
                try {
                    if (link.startsWith('vless://')) nodes.push(parseVless(link));
                    else if (link.startsWith('vmess://')) nodes.push(parseVmess(link));
                } catch (e) { }
            });
            updateDialer();
        }

        function updateDialer() {
            const sel = document.getElementById('res-dialer');
            const val = sel.value;
            sel.innerHTML = '<option value="">-- é€‰æ‹©è½åœ°çš„ VPS èŠ‚ç‚¹ --</option>' +
                nodes.map(n => `<option value="${n.name}">${n.name}</option>`).join('');
            if (nodes.find(n => n.name === val)) sel.value = val;
        }

        function parseVless(link) {
            const name = decodeURIComponent(link.split('#')[1] || "Server_" + Math.random().toString(36).substr(2, 4));
            const url = new URL(link.split('#')[0]);
            const params = new URLSearchParams(url.search);
            return {
                name, type: 'vless', server: url.hostname, port: parseInt(url.port),
                uuid: url.username, tls: params.get('security') === 'reality' || params.get('security') === 'tls',
                servername: params.get('sni'), flow: params.get('flow'),
                'reality-opts': params.get('security') === 'reality' ? { 'public-key': params.get('pbk'), 'short-id': params.get('sid') } : null,
                network: params.get('type') || 'tcp'
            };
        }

        function parseVmess(link) {
            const data = JSON.parse(atob(link.replace('vmess://', '')));
            return {
                name: data.ps, type: 'vmess', server: data.add, port: parseInt(data.port),
                uuid: data.id, alterId: parseInt(data.aid || 0), cipher: 'auto',
                tls: data.tls === 'tls', network: data.net || 'tcp'
            };
        }

        async function processMagic() {
            parseBatch();
            if (nodes.length === 0) { alert("æ²¡æœ‰æœ‰æ•ˆçš„èŠ‚ç‚¹é“¾æ¥ï¼"); return; }

            document.getElementById('status').style.display = 'inline-flex';
            document.getElementById('status-text').innerText = "æ­£åœ¨æ„å»º Ultimate é€»è¾‘æ¶æ„...";

            const isWin = document.getElementById('opt-win').checked;
            const useProvider = document.getElementById('opt-provider').checked;
            const res = JSON.parse(localStorage.getItem('ultra_res') || '{}');

            let yaml = `# Clash Ultimate Generated by Kenny-BBDog\n`;
            yaml += `port: 7890\nsocks-port: 7891\nmixed-port: 7892\nallow-lan: true\nmode: rule\nlog-level: info\nipv6: false\n`;

            if (isWin) {
                yaml += `geodata-mode: true\nunified-delay: true\ntcp-concurrent: true\n`;
            }

            // DNS
            yaml += `\ndns:\n  enable: true\n  enhanced-mode: fake-ip\n  fake-ip-range: 198.18.0.1/16\n  nameserver:\n    - https://doh.pub/dns-query\n    - https://dns.alidns.com/dns-query\n  fallback:\n    - https://dns.google/dns-query\n\n`;

            // Proxies
            yaml += `proxies:\n`;
            nodes.forEach(n => {
                yaml += `  - {name: "${n.name}", type: ${n.type}, server: ${n.server}, port: ${n.port}, uuid: ${n.uuid}`;
                if (n.type === 'vmess') yaml += `, alterId: ${n.alterId}, cipher: ${n.cipher}`;
                if (n.tls) yaml += `, tls: true, servername: ${n.servername}`;
                if (n.flow) yaml += `, flow: ${n.flow}`;
                if (n['reality-opts']) yaml += `, reality-opts: {public-key: ${n['reality-opts']['public-key']}, short-id: ${n['reality-opts']['short-id']}}`;
                yaml += `, network: ${n.network}}\n`;
            });

            if (res.enabled && res.host) {
                yaml += `  - {name: "ä½å®…IP", type: socks5, server: ${res.host}, port: ${res.port}, username: ${res.user}, password: ${res.pass}, dialer-proxy: "${res.dialer}"}\n`;
            }

            // Groups
            yaml += `\nproxy-groups:\n  - name: ğŸš€ ä»£ç†é€‰æ‹©\n    type: select\n    proxies:\n`;
            if (res.enabled) yaml += `      - ä½å®…IP\n`;
            nodes.forEach(n => yaml += `      - "${n.name}"\n`);
            yaml += `      - DIRECT\n\n`;

            // Rule Providers
            if (useProvider) {
                yaml += `rule-providers:\n`;
                yaml += `  wechat:\n    type: http\n    behavior: domain\n    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/WeChat/WeChat.yaml"\n    path: ./rules/wechat.yaml\n    interval: 86400\n`;
                yaml += `  ai:\n    type: http\n    behavior: domain\n    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/OpenAI/OpenAI.yaml"\n    path: ./rules/ai.yaml\n    interval: 86400\n`;
            }

            // Rules
            yaml += `\nrules:\n  - IP-CIDR,127.0.0.0/8,DIRECT\n  - IP-CIDR,192.168.0.0/16,DIRECT\n`;

            const aiProxy = res.enabled ? "ä½å®…IP" : "ğŸš€ ä»£ç†é€‰æ‹©";

            if (useProvider) {
                yaml += `  - RULE-SET,ai,${aiProxy}\n`;
                yaml += `  - RULE-SET,wechat,DIRECT\n`;
            } else {
                // Fallback hardcoded
                yaml += `  - DOMAIN-SUFFIX,openai.com,${aiProxy}\n  - DOMAIN-SUFFIX,chatgpt.com,${aiProxy}\n  - DOMAIN-SUFFIX,claude.ai,${aiProxy}\n`;
                yaml += `  - DOMAIN-SUFFIX,qpic.cn,DIRECT\n  - DOMAIN-SUFFIX,weixin.qq.com,DIRECT\n`;
            }

            yaml += `  - DOMAIN-SUFFIX,cn,DIRECT\n  - MATCH,ğŸš€ ä»£ç†é€‰æ‹©\n`;

            finalYaml = yaml;
            document.getElementById('output').innerText = yaml;
            document.getElementById('platform-tag').innerText = isWin ? "Windows / Mihomo" : "Android / Meta";
            document.getElementById('result').style.display = 'block';
            document.getElementById('status-text').innerText = "ç”ŸæˆæˆåŠŸï¼éšæ—¶å¯ä»¥æ³¨å…¥ã€‚";

            setTimeout(() => {
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            }, 100);
        }

        function copyAll() {
            navigator.clipboard.writeText(finalYaml);
            alert("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼å¯ä»¥ç›´æ¥å» Clash ç²˜è´´äº†ã€‚");
        }

        function downloadFile() {
            const blob = new Blob([finalYaml], { type: 'text/yaml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = document.getElementById('opt-win').checked ? "ultimate_win.yaml" : "ultimate_android.yaml";
            a.click();
        }
    </script>
</body>

</html>